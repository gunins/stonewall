define("templating/utils/List",[],function(){"use strict";class t{constructor(t){this._map=new Map(t),this._indexes=[...this._map.keys()],this._onDelete=[]}keys(){return this._indexes}values(){return this.entries().map(t=>{return t[1]})}entries(){return this._indexes.map(t=>{return[t,this._map.get(t)]})}get(t){return this._map.get(t)}forEach(t){return this.values().forEach((e,n,...i)=>{return t.apply(null,[e,n,...i])})}getIndex(t){return this._indexes.indexOf(t)}changeIndex(t,e){if(t){let n=this._indexes,i=n.indexOf(t);i!==-1&&e!==i&&this._indexes.splice(e,0,this._indexes.splice(i,1)[0])}}getValueByIndex(t){return this._map.get(this._indexes[t])}get first(){return this.getValueByIndex(0)}get last(){return this.getValueByIndex(this._indexes.length-1)}getKeyByIndex(t){return this._indexes[t]}set(t,e,n){this._map.set(t,e),void 0!==n?this._indexes.splice(n,0,t):this._indexes.push(t)}has(t){return this._map.has(t)}clear(){this._map.clear(),this._indexes.splice(0,this._indexes.length)}onDelete(t){let e=(...e)=>t(...e);return this._onDelete.push(e),{remove(){this._onDelete.splice(this._onDelete.indexOf(e,1))}}}delete(t){if(this.has(t)){let e=this._map.get(t);this._map.delete(t),this._indexes.splice(this._indexes.indexOf(t),1),this._onDelete.forEach(n=>n(t,this.size,e))}}deleteByIndex(t){this.delete(this._indexes[t])}get size(){return this._map.size}}return t}),define("templating/dom",[],function(){"use strict";function t(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function e(t){var e=document.createElement(t||"div");return e.setAttribute("style","display:none;"),e}function n(t){let e=Object.keys(t);e.length>0&&e.forEach(e=>{if("root"!==e){let n=t[e];void 0!==n.elGroup&&n.elGroup.size>0&&n.elGroup.forEach(t=>{void 0!==t&&void 0!==t.remove&&t.remove(!0)})}})}class i{constructor(t,e){this.el=t,this._events=[],this.name=e.name||e.data.name;let n=this.data=e.data;n&&n.bind&&(this.bind=n.bind)}clone(...t){return this.run(...t)}text(t){r.text(this,t)}detach(){r.detach(this)}attach(){r.attach(this)}changePosition(t){r.changePosition(this,t)}setAttribute(t,e){r.setAttribute(this,t,e)}getAttribute(t){return r.getAttribute(this,t)}removeAttribute(t){r.removeAttribute(this,t)}setStyle(t,e){r.setStyle(this,t,e)}getStyle(t){return r.getStyle(this,t)}removeStyle(t){r.removeStyle(this,t)}addClass(t){r.addClass(this,t)}hasClass(t){return r.hasClass(this,t)}removeClass(t){r.removeClass(this,t)}val(t){return r.val(this,t)}on(t,e,n){var i=Array.prototype.slice.call(arguments,0);return r.on.apply(!1,[this].concat(i))}onDOMAttached(){return r.onDOMAttached(this)}remove(t){r.remove(this,t)}}var r={detach(t){t.placeholder instanceof HTMLElement==!1&&(t.placeholder=e(t.data.tag||t.el.tagName)),t&&t.el&&t.el.parentNode&&t.el.parentNode.replaceChild(t.placeholder,t.el)},attach(t){t&&t.el&&t.placeholder&&t.placeholder.parentNode&&t.placeholder.parentNode.replaceChild(t.el,t.placeholder)},append(t,e){void 0!==t.el&&void 0!==e.el&&t.el.appendChild(e.el)},prepend(t,e){r.insertBefore(t,e,0)},insertBefore(t,e,n){let i=t.el,r=e.el;void 0!==i&&void 0!==r&&(void 0!==i.childNodes[n]?i.insertBefore(r,i.childNodes[n]):i.appendChild(r))},changePosition(t,e){let n=t.el;if(n&&n.parentNode){let i=n.parentNode,r=t.elGroup,o=r.size,s=r.getKeyByIndex(e)||r.getLast();s!==n&&(o-1>=e?i.insertBefore(n,s):null!==s.nextSibling?i.insertBefore(n,s.nextSibling):i.appendChild(n),t.elGroup.changeIndex(n,e))}},text(t,e){t&&t.el&&(t.el.innerHTML=e)},setAttribute(e,n,i){e&&e.el&&(t(n)?Object.keys(n).forEach(t=>{e.el.setAttribute(t,n[t])}):e.el.setAttribute(n,i))},getAttribute(t,e){return t&&t.el?t.el.getAttribute(e):void 0},removeAttribute(t,e){t&&t.el&&t.el.removeAttribute(e)},setStyle(e,n,i){e&&e.el&&(t(n)?Object.keys(n).forEach(t=>{e.el.style[t]=n[t]}):e.el.style[n]=i)},getStyle(t,e){if(t&&t.el)return void 0!==t.el&&void 0!==t.el.style?t.el.style[e]:void 0},removeStyle(t,e){t&&t.el&&(t.el.style[e]="")},addClass(t,e){t&&t.el&&t.el.classList.add(e)},hasClass(t,e){return!(!t||!t.el)&&t.el.classList.contains(e)},removeClass(t,e){t&&t.el&&t.el.classList.remove(e)},val(t,e){if(t&&t.el){var n=t.el;if(void 0===e)return n.value;n.value=e}},on(t,e,n,i,...r){var o=t.el,s=e.split(" "),c=e=>{n.apply(i||this,[e,t].concat(r))};s.forEach(t=>{o.addEventListener(t,c)});var a={remove:()=>{s.forEach(t=>o.removeEventListener(t,c));let e=t._events;e.splice(e.indexOf(a),1)}};return t._events.push(a),a},remove(t){for(;t._events.length>0;)t._events.shift().remove();t.children&&n(t.children),void 0!==t.elGroup&&t.elGroup.delete(t.el),void 0!==t.el&&(t.el.remove?t.el.remove():t.el.parentNode&&t.el.parentNode.removeChild(t.el),delete t.el)},onDOMAttached(t){let e,n=[],i=!1;return void 0!==t.el&&(e=(()=>{if(i)for(;n.length>0;)n.shift()();else window.requestAnimationFrame(e),document.body.contains(t.el)&&(i=!0)})),{then:(t,i)=>{n.push(t.bind(i||this)),window.requestAnimationFrame(e)}}},Element:i};return r}),function(t,e){"function"==typeof define&&define.amd?define("templating/DomFragment",e):"object"==typeof exports&&(module.exports=e())}(0,function(){"use strict";function t(t){var e=document.createElement(t||"div");return e.setAttribute("style","display:none;"),e}class e{constructor(t,e,n,i,r,o){return Object.assign(this,{_node:t,placeholder:e,childNodes:n,elGroup:i,index:r,obj:o}),this.render()}applyAttributes(t){let e=this._node.data.attribs;Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}applyFragment(t){let e=this._node,n=e.template();if(n)for(;n.childNodes.length>0;)t.appendChild(n.childNodes[0])}appendToBody(t){let e=this.elGroup,n=this.placeholder,i=e.size;if(i>0){let n=void 0===this.index||this.index>i-1?i-1:this.index-1,r=e.keys()[n!==-1?n:0],o=r.parentNode;n===-1?o.insertBefore(t,r):null!==r.nextSibling?o.insertBefore(t,r.nextSibling):o.appendChild(t)}else{let e=n.parentNode;e&&e.replaceChild(t,n)}}render(){let e=this.placeholder,n=this._node,i=!e.id&&0===this.elGroup.size,r=n.tmpEl(!!i&&e,this.obj,this.childNodes,n),o=r.el||t(n.data.tag);return i||n.replace?n.replace||(o.innerHTML=""):this.applyAttributes(o),n.replace||this.applyFragment(o),this.appendToBody(o),r.ready&&r.ready(o),r}}return e}),function(t,e){"function"==typeof define&&define.amd?define("templating/Decoder",["./utils/List","./dom","./DomFragment"],e):"object"==typeof exports&&(module.exports=e(require("./utils/List"),require("./dom"),require("./DomFragment")))}(0,function(t,e,n){"use strict";function i(t){return t===Object(t)}function r(t){return Array.isArray?Array.isArray(t):"[object Array]"===toString.call(t)}var o={};class s{static addDecoder(t){void 0===o[t.tagName]&&(o[t.tagName]=t)}constructor(t){this._root="string"==typeof t?JSON.parse(t):t,t.children&&t.children.length>0&&(this.children=this._parseElements(t.children))}renderFragment(t,e){let n=document.createElement("template");return void 0===n.content&&("td"===e?n=document.createElement("tr"):"tr"===e&&(n=document.createElement("tbody"))),n.innerHTML=t,void 0!==n.content?n.content.firstChild:n.firstChild}_parseElements(t){var e={};return t.forEach(t=>{let n=t.data.name;var i=t.tagName;if(i){let r=o[i].decode(t);if(r){let s={name:r.name,data:r.data,tmpEl:r.tmpEl,parse:r.parse,replace:r.replace,id:t.id,template:()=>{return this.renderFragment(t.template,t.data.tag)},noAttach:o[i].noAttach||t.data.tplSet.noattach};t.children&&t.children.length>0&&(s.children=this._parseElements(t.children)),e[n]=s}}else n&&(e[n]={id:t.id,data:t.data,name:n})}),e}renderTemplate(o={},s={},c){let a={},u=[];Object.keys(o).forEach(h=>{let l=c,d=o[h],f=d.children,p=new t,g=document.createElement(d.data.tplSet.tag||"div");if(g.setAttribute("style","display:none;"),g.id=d.id,p.onDelete((t,e)=>{0===e&&t.parentNode&&(t.parentNode.replaceChild(g,t),l=(()=>g))}),d.template){let t=(e,o)=>{let c=l();e instanceof HTMLElement==!0&&(c=e);let a,u=c!==e&&(i(e)||r(e))?e:s;if(!d.noAttach||e){let e=c.querySelector("#"+d.id)||c;f&&(a=this.renderTemplate(f,u,()=>{return c}));let i=new n(d,e,a,p,o,u);return c=i.el,a&&a.runAll&&d.parse&&a.runAll(),a&&!i.children&&(i.children=a),i.elGroup=p,i.run=t,p.set(i.el,i,o),i}};u.push(t),a[h]={data:d.data,run:t,elGroup:p}}else{let t=new e.Element(l().querySelector("#"+d.id),d);t.removeAttribute("id"),t.elGroup=p,p.set(t.el,t),a[h]=t}});let h=(t,e,n)=>{Object.defineProperty(t,e,{enumerable:!1,value:n})},l=t=>{return u.forEach(e=>e(t)),a};return h(a,"runAll",l),a}render(t){var e=this.renderFragment(this._root.template);return{fragment:e,children:this.renderTemplate(this.children,t,()=>e).runAll(),templateId:this._root.templateId}}}return s}),function(t,e){"function"==typeof define&&define.amd?define("coders/component/cpDecoder",["templating/Decoder"],e):"object"==typeof exports&&(module.exports=e(require("./Decoder")))}(0,function(t){"use strict";var e={tagName:"cp",decode:function(t){var e=t.data,n={name:e.name,replace:!0,tmpEl:function(t,n,i,r){return new e.src(e.dataset,i,n,r)},data:e||{}};return void 0!==e.dataset.bind&&(n.bind=e.dataset.bind),n}};return t&&t.addDecoder(e),e}),function(t,e){"function"==typeof define&&define.amd?define("coders/placeholders/plDecoder",["templating/Decoder","templating/dom"],e):"object"==typeof exports&&(module.exports=e(require("./Decoder"),require("./dom")))}(0,function(t,e){"use strict";var n={tagName:"pl",decode:function(t){var n=t.data;return{name:n.name,tmpEl:function(t,i,r,o){return new e.Element(t||document.createElement(n.tag),o)},parse:!0,data:n}}};return t&&t.addDecoder(n),n}),function(t,e){"function"==typeof define&&define.amd?define("coders/databind/bdDecoder",["templating/Decoder","templating/dom"],e):"object"==typeof exports&&(module.exports=e(require("./Decoder"),require("./dom")))}(0,function(t,e){"use strict";var n={tagName:"bd",noAttach:!0,decode:function(t){var n=this.data=t.data;return{name:n.name,tmpEl:function(t,i,r,o){return new e.Element(t||document.createElement(n.tag),o)},data:n}}};return t&&t.addDecoder(n),n}),function(t,e){"function"==typeof define&&define.amd?define("coders/router/routerDecoder",["templating/Decoder","templating/dom"],e):"object"==typeof exports&&(module.exports=e(require("./Decoder"),require("./dom")))}(0,function(t,e){"use strict";var n={tagName:"rt",noAttach:!0,decode:function(t){var n=t.data;return{name:n.name,tmpEl:function(t,i,r,o){return new e.Element(t||document.createElement(n.tag),o)},parse:!0,data:n||{}}}};return t&&t.addDecoder(n),n}),function(t,e){"function"==typeof define&&define.amd?define("coders/style/styleDecoder",["templating/Decoder"],e):"object"==typeof exports&&(module.exports=e(require("./Decoder")))}(0,function(t){"use strict";var e={tagName:"style",decode:function(t){if(void 0===t.data.styleAttached){t.data.styleAttached=!0;let e=t.data.style,n=t=>{let e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e)};"string"==typeof e?n(e):e.then(n)}}};return t&&t.addDecoder(e),e}),function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("watch",t):(window.WatchJS=t(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){var t={noMore:!1},e=[],n=function(t){var e={};return t&&"[object Function]"==e.toString.call(t)},i=function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=function(t,e){var n=[],r=[];if("string"!=typeof t&&"string"!=typeof e){if(i(t))for(var o=0;o<t.length;o++)void 0===e[o]&&n.push(o);else for(var o in t)t.hasOwnProperty(o)&&void 0===e[o]&&n.push(o);if(i(e))for(var s=0;s<e.length;s++)void 0===t[s]&&r.push(s);else for(var s in e)e.hasOwnProperty(s)&&void 0===t[s]&&r.push(s)}return{added:n,removed:r}},o=function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var n in t)e[n]=t[n];return e},s=function(t,e,n,i){try{Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}catch(r){try{Object.prototype.__defineGetter__.call(t,e,n),Object.prototype.__defineSetter__.call(t,e,i)}catch(t){throw new Error("watchJS error: browser not supported :/")}}},c=function(t,e,n){try{Object.defineProperty(t,e,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(i){t[e]=n}},a=function(){n(arguments[1])?u.apply(this,arguments):i(arguments[1])?h.apply(this,arguments):l.apply(this,arguments)},u=function(t,e,n,r){if("string"!=typeof t&&(t instanceof Object||i(t))){var o=[];if(i(t))for(var s=0;s<t.length;s++)o.push(s);else for(var c in t)"$val"!=c&&Object.prototype.hasOwnProperty.call(t,c)&&o.push(c);h(t,o,e,n,r),r&&w(t,"$$watchlengthsubjectroot",e,n)}},h=function(t,e,n,r,o){if("string"!=typeof t&&(t instanceof Object||i(t)))for(var s=0;s<e.length;s++){var c=e[s];l(t,c,n,r,o)}},l=function(t,e,r,o,s){"string"!=typeof t&&(t instanceof Object||i(t))&&(n(t[e])||(null!=t[e]&&(void 0===o||o>0)&&u(t[e],r,void 0!==o?o-1:o),g(t,e,r,o),s&&(void 0===o||o>0)&&w(t,e,r,o)))},d=function(){n(arguments[1])?f.apply(this,arguments):i(arguments[1])?p.apply(this,arguments):_.apply(this,arguments)},f=function(t,e){if(!(t instanceof String)&&(t instanceof Object||i(t)))if(i(t)){for(var n=[],r=0;r<t.length;r++)n.push(r);p(t,n,e)}else{var o=function(t){var n=[];for(var i in t)t.hasOwnProperty(i)&&(t[i]instanceof Object?o(t[i]):n.push(i));p(t,n,e)};o(t)}},p=function(t,e,n){for(var i in e)e.hasOwnProperty(i)&&_(t,e[i],n)},g=function(e,n,i,r){var o=e[n];b(e,n),e.watchers||c(e,"watchers",{});var a=!1;e.watchers[n]||(e.watchers[n]=[],a=!0);for(var h=0;h<e.watchers[n].length;h++)if(e.watchers[n][h]===i)return;if(e.watchers[n].push(i),a){var l=function(){return o},d=function(s){var c=o;o=s,0!==r&&e[n]&&u(e[n],i,void 0===r?r:r-1),b(e,n),t.noMore||c!==s&&(m(e,n,"set",s,c),t.noMore=!1)};s(e,n,l,d)}},m=function(t,e,n,i,r){if(void 0!==e)for(var o=0;o<t.watchers[e].length;o++)t.watchers[e][o].call(t,e,n,i,r);else for(var e in t)t.hasOwnProperty(e)&&m(t,e,n,i,r)},v=["pop","push","reverse","shift","sort","slice","unshift","splice"],y=function(t,e,n,i){c(t[e],i,function(){var r=n.apply(t[e],arguments);return l(t,t[e]),"slice"!==i&&m(t,e,i,arguments),r})},b=function(t,e){if(t[e]&&!(t[e]instanceof String)&&i(t[e]))for(var n,r=v.length;r--;)n=v[r],y(t,e,t[e][n],n)},_=function(t,e,n){for(var i=0;i<t.watchers[e].length;i++){t.watchers[e][i]==n&&t.watchers[e].splice(i,1)}E(t,e,n)},x=function(){for(var t=0;t<e.length;t++){var n=e[t];if("$$watchlengthsubjectroot"===n.prop){var i=r(n.obj,n.actual);(i.added.length||i.removed.length)&&(i.added.length&&h(n.obj,i.added,n.watcher,n.level-1,!0),n.watcher.call(n.obj,"root","differentattr",i,n.actual)),n.actual=o(n.obj)}else{var i=r(n.obj[n.prop],n.actual);if(i.added.length||i.removed.length){if(i.added.length)for(var s=0;s<n.obj.watchers[n.prop].length;s++)h(n.obj[n.prop],i.added,n.obj.watchers[n.prop][s],n.level-1,!0);m(n.obj,n.prop,"differentattr",i,n.actual)}n.actual=o(n.obj[n.prop])}}},w=function(t,n,i,r){var s;s=o("$$watchlengthsubjectroot"===n?t:t[n]),e.push({obj:t,prop:n,actual:s,watcher:i,level:r})},E=function(t,n,i){for(var r=0;r<e.length;r++){var o=e[r];o.obj==t&&o.prop==n&&o.watcher==i&&e.splice(r,1)}};return setInterval(x,50),t.watch=a,t.unwatch=d,t.callWatchers=m,t}),define("widget/parsers/addChildren",[],function(){"use strict";function t(t,r,o){if(r&&r.name&&t){i(t,r,o),n(t,r,o);let s=e(t,r);return s&&s(o),t.children[r.name]=r,r}}function e(t,e){return void 0!==t.elOnChange[e.name]&&(n=>t.elOnChange[e.name].call(t,e,n))}function n(t,e,n){void 0!==t.elReady[e.name]&&t.elReady[e.name].call(t,e,n)}function i(t,e,n){var i=t.events[e.name];void 0!==i&&void 0!==e.el&&"cp"!==e.data.type&&i.forEach(i=>{t._events.push(e.on(i.name,i.action,t,n))})}return Object.assign(t,{elOnChange:e,elReady:n,applyEvents:i}),t}),define("widget/parsers/applyAttribute",["watch","./addChildren"],function(t,e){function n(t,n,r){var o=n.data.tplSet.bind,s=n.data.tplSet.update;o&&Object.keys(o).forEach(c=>{let a=o[c],u=r[a];switch(c){case"class":let t=t=>{return void 0!==t&&""!==t&&(n.addClass(t),t)},e=t(u);s===!0&&i(r,a,()=>{e&&n.removeClass(e),e=t(r[a])});break;case"checked":void 0!==u&&(n.el.checked=u),s===!0&&i(r,a,()=>n.el.checked=r[a]);break;case"value":void 0!==u&&(n.el.value=u),s===!0&&i(r,a,()=>n.el.value=r[a]);break;case"required":void 0!==u&&(n.el.required=u),s===!0&&i(r,a,()=>n.el.required=r[a]);break;case"text":void 0!==u&&n.text(u),s===!0&&i(r,a,()=>n.text(r[a]));break;default:void 0!==u&&n.setAttribute(c,u),s===!0&&i(r,a,()=>n.setAttribute(c,r[a]))}if(void 0!==r.text&&"text"!==c&&(n.text(r.text),s===!0&&"text"!==c&&i(r,"text",()=>n.text(r.text))),s===!0){let o=e.elOnChange(t,n);o&&i(r,a,()=>o(r))}})}var i=t.watch;return n}),define("widget/parsers/applyParent",["templating/dom","./addChildren"],function(t,e){function n(n,i={},r={}){if(n){let o=n.children;o&&Object.keys(o).forEach(s=>{let c=!0,a=o[s],u=i[s];void 0!==u?void 0!==n.nodes[s]?n.nodes[s].call(n,a,u,r):void 0!==a&&("string"==typeof u?t.text(a,u):a=u.run(a.el)):void 0!==n.nodes[s]&&a.data.tplSet.noattach&&(n.nodes[s].call(n,a,r),c=!1),c&&a.elGroup.size>0&&e(n,a,r)})}}return n}),define("widget/utils",[],function(){function t(t){var e=typeof t;if(!("function"===e||"object"===e&&t))return t;for(var n,i,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(i in n)t[i]=n[i]}return t}function e(e,n){var i,r=this;i=e&&null!=e&&hasOwnProperty.call(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},t(i,r,n);var o=function(){this.constructor=i};return o.prototype=r.prototype,i.prototype=new o,e&&t(i.prototype,e),i.__super__=r.prototype,i}function n(t){return"[object String]"===toString.call(t)}function i(t){return t===Object(t)}function r(t){return Array.isArray?Array.isArray(t):"[object Array]"===toString.call(t)}return{fnExtend:e,extend:t,isString:n,isObject:i,isArray:r}}),define("widget/parsers/setBinders",[],function(){function t(t,e){let n={};return Object.defineProperty(n,"__cp__",{enumerable:!1,value:[]}),Object.keys(t).forEach(i=>{let r=t[i];r&&r.data&&void 0!==r.data.bind&&"cp"!==r.data.type?(n[r.data.bind]=n[r.data.bind]||[],n[r.data.bind].push(r)):e||"cp"!==r.data.type||n.__cp__.push(r)}),n}return t}),define("widget/parsers/applyBinders",["templating/dom","../utils","watch","./setBinders","./addChildren","./applyAttribute"],function(t,e,n,i,r,o){function s(t,n,s,u){if(void 0!==u){var h=s[n];if(t.nodes[n])t.nodes[n].call(t,u,h);else if(e.isArray(h)||e.isObject(h)){if(e.isArray(h)){let l=[],d=(n,s)=>{let a=!1;e.isArray(n)||e.isObject(n)||(a=!0);let h=u.run(!0,s);a&&h.text(n),l.push({binder:h,data:n}),o(t,h,n),r.applyEvents(t,h,n),r.elReady(t,h,n);let d=r.elOnChange(t,h);d&&d(n),h.children&&(h.bindings=i(h.children),c(t,n,h))};h.forEach(d);let f=u.data.tplSet.update;if(f){let t=["pop","shift","splice"],e=["push","unshift"],i=["reverse","sort"];a(s,n,(r,o,c,a)=>{let u=l.slice(0);if(void 0===a&&e.indexOf(o)!==-1){let t=u.filter(t=>t.data===c[0]);0===t.length&&d(c[0],"unshift"===o?0:u.length)}else if(t.indexOf(o)!==-1){if(u.forEach(t=>{s[n].indexOf(t.data)===-1&&(t.binder.remove(),l.splice(l.indexOf(t),1))}),"splice"===o){let t=Array.prototype.slice.call(c,2);t&&t.length>0&&t.forEach(t=>{let e=s[n].indexOf(t);e!==-1&&d(t,e)})}}else i.indexOf(o)!==-1&&h.forEach((t,e)=>{let n=u.filter(e=>e.data===t)[0];l.splice(e,0,l.splice(l.indexOf(n),1)[0]),n.binder.changePosition(e)})})}}else if(e.isObject(h)){let e=u.run(h);if("cp"!==e.data.type){o(t,e,h),r.applyEvents(t,e,h),r.elReady(t,e,h);let n=r.elOnChange(t,e);n&&n(h),e.children&&(e.bindings=i(e.children),c(t,h,e))}}}else{let e=u.run(!0);e.text(h),r.applyEvents(t,e,h),r.elReady(t,e,h);let i=r.elOnChange(t,e);i&&i(h),e.data.tplSet.update&&a(s,n,()=>{e.text(s[n]);let i=r.elOnChange(t,e);i&&i(s[n])})}}}function c(t,e,n){let i=n.bindings;if(i){i.__cp__.length>0&&i.__cp__.forEach(n=>{let i=n.run(e);i.setContext(t.context),r.elReady(t,i,e);let o=r.elOnChange(t,i);o&&o(e)});let n=Object.keys(i);e&&n.length>0&&n.forEach(n=>{if(void 0!==e[n])i[n].forEach(i=>s(t,n,e,i));else{let r=(o,c,a,h)=>{void 0!==a&&void 0===h&&(i[n].forEach(i=>s(t,n,e,i)),u(e,n,r))};a(e,n,r,0)}})}}var a=n.watch,u=n.unwatch;return c}),define("widget/parsers/setRoutes",["templating/dom"],function(t){function e(t){let e=t.toString().replace(c,""),n=e.slice(e.indexOf("(")+1,e.indexOf(")")),i=n.match(a);return null===i?[]:i.map(t=>t.replace(/[\s,]/g,""))}function n(t){void 0!==t.remove&&t.remove()}function i(t,e){void 0!==t&&Object.keys(t).forEach(n=>{let i=t[n];r(i,e)||e(i)})}function r(t,e){return!!(t.elGroup&&t.elGroup.size>0)&&(t.elGroup.forEach(t=>{e(t)}),!0)}function o(s,c){if(s.setContext)s.setContext(c);else{let a=void 0!==s.data?s.data.route:void 0;if(void 0!==a&&"rt"===s.data.type){let u,h=c.match,l=c.active,d=h(a);d.to((...e)=>{let n=e.pop();if(u=e.length>0?n.getLocation()+"_"+e.join("_"):void 0,!r(s,e=>t.attach(e))){let t=s.run(!0);i(t.children,t=>{t&&h(a,e=>o(t,Object.assign({},c,{match:e,active:l})))})}r(s,t=>{i(t.children,t=>{t&&t.to&&t.to(...e.concat(n))})})}),d.leave(done=>{let o=0,c=!1;r(s,r=>{let s=()=>{u?n(r):t.detach(r)},a=(t=!0)=>{t?o--:(c=!0,done(!1)),0!==o||c||(l.set(r,s),done(!0))};i(r.children,t=>{if(t&&void 0!==t.leave){let n=e(t.leave);n.length>0&&o++,t.leave(a)}}),0===o&&(l.set(r,s),done(!0))})}),d.query(t=>{r(s,e=>{i(e.children,e=>{e&&void 0!==e.query&&e.query(t)})})}),r(s,t=>t._activeRoute=d)}else void 0!==s.children&&["cp"].indexOf(s.data.type)===-1&&i(s.children,t=>o(t,c))}}function s(t,e){i(t,t=>o(t,e))}const c=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,a=/(?:^|,)\s*([^\s,=]+)/g;return s}),define("widget/parsers/applyElement",["templating/dom"],function(t){function e(e={},n){let i={};return Object.keys(e).forEach(r=>{let o=e[r];if("string"!=typeof o){let e=o.elGroup.first;if(e){if(i[r]=e,e instanceof t.Element==!0&&["pl"].indexOf(e.data.type)!==-1){let t=e.data.tplSet.bind;t&&Object.keys(t).forEach(i=>{void 0!==n[t[i]]&&("class"!==i?e.setAttribute(i,n[t[i]]):e.addClass(n[t[i]]))})}}else i[r]=o}}),i}return e}),define("widget/Constructor",["require","templating/Decoder","templating/dom","./Mediator","./parsers/applyAttribute","./parsers/applyParent","./parsers/applyBinders","./parsers/setBinders","./parsers/setRoutes","./parsers/applyElement","./parsers/addChildren"],function(t,e,n,i,r,o,s,c,a,u,h){"use strict";function l(t){let e=Object.keys(t);e.length>0&&e.forEach(e=>{if("root"!==e){let n=t[e];void 0!==n.elGroup&&n.elGroup.size>0&&n.elGroup.forEach(t=>{void 0!==t&&void 0!==t.remove&&t.remove(!0)})}})}class d{static extend(t={}){class e extends d{}return Object.assign(e.prototype,t),e}constructor(t={},e,n={},r){this.instance=this,this._events=[],this._globalEvents=[],this._parentChildren=e,this._options=t,this._rendered=!1,this._arguments=Array.from(arguments),this._dataSet=n,this.eventBus=new i(this),void 0!==r&&void 0!==r.name&&(this.name=r.name),this.beforeInit(...this._arguments)}ready(t){this.el=t}setContext(t){this.context||(this.context=t,this.async||this.render(),this.init(...this._arguments))}set context(t){if(!this.data){let e=this._dataSet?Object.keys(this._dataSet):[],n=e.length>0?this._dataSet:t.data;n&&(this.data=n[this._options.bind]||n)}t.match(e=>{this.match&&this.match(e),this._context=Object.assign({match:e},t)})}get context(){return this._context}render(t){if(!this._rendered)if(this.template){t&&(this.data=t);let i=this._options,r=this._parentChildren,s=new e(this.template),l=s.render(this.data);if(this.el){let t=this.el.parentNode;t&&t.replaceChild(l.fragment,this.el),this.elGroup&&this.elGroup.get(this.el)&&(this.elGroup.delete(this.el),this.el=l.fragment,this.elGroup.set(l.fragment,this))}else this.el=l.fragment;this.root=new n.Element(l.fragment,{name:"root",data:{}}),this.children=u(l.children,i),o(this,r,this.data),this.bindings=c(this.children,!0),this.data&&this.applyBinders(this.data,this),a(this.children,this.context),h(this,this.root),this.rendered(...this._arguments),this._rendered=!0}else this.root=new n.Element("<div></div>",{name:"root",data:{}}),this.el=this.root.el,this.rendered(...this._arguments),this._rendered=!0}beforeInit(t,e,n){}init(t,e,n){}rendered(t,e,n){}loadCss(t){if(this.context._cssReady.indexOf(t)===-1){this.context._cssReady.push(t);let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",t),void 0!==e&&document.getElementsByTagName("head")[0].appendChild(e)}}detach(){this._placeholder||(this._placeholder=document.createElement(this.el.tagName)),this._parent||(this._parent=this.el.parentNode),this.el&&this._parent&&this._parent.replaceChild(this._placeholder,this.el)}attach(){this._placeholder&&this._parent&&this._parent.replaceChild(this.el,this._placeholder)}onDestroy(){}destroy(){for(this.onDestroy(),this.eventBus.clear();this._events.length>0;)this._events.shift().remove();for(;this._globalEvents.length>0;)this._globalEvents.shift().remove();l(this.children),void 0!==this.elGroup&&void 0!==this.el&&this.elGroup.delete(this.el),this.root&&this.root.remove&&this.root.remove(),delete this.el}remove(...t){this.destroy(...t)}setChildren(t,e){let n=t.data.name,i=this.children[n];void 0!==i&&void 0!==i.el&&i.remove();let r=t.run(e||!0);return r.setContext&&r.setContext(this.context),h(this,r,e),r}addComponent(t,e){let n=e.name,i=e.container;if(void 0===n)throw"you have to define data.name for component.";if(void 0===i)throw"You have to define container for component.";if(void 0!==this.children[n])throw"Component using name:"+n+"! already defined.";let r=this.setComponent(t,e),o=r.run(e.container);return o.setContext(this.context),this.children[n]=o,o}setComponent(t,e){return{name:e.name,data:{tag:"div",type:"cp"},run:i=>{e.appContext=this.context;let r=new t(e,e.children,e.data),o=document.createElement("div");return o.setAttribute("style","display:none;"),r.ready(o),i instanceof HTMLElement==!0?i.parentNode.replaceChild(r.el,i):void 0!==i.el&&void 0!==e.pos?n.insertBefore(i,r,e.pos):void 0!==i.el&&n.append(i,r),r}}}applyBinders(...t){return s(this,...t)}}return Object.assign(d.prototype,{nodes:{},events:{},elReady:{},elOnChange:{}}),d}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("widget/Mediator",[],function(){return e()}):"undefined"!=typeof exports?exports.Mediator=e():t.Mediator=e()}(this,function(){"use strict";class t{constructor(t,e,n={},i=null){this.fn=t,this.channel=i,this.context=n,this.options=e}update(t={}){Object.assign(this,t),this.channel&&this.setPriority(this.priority)}set options(t){this.update(t)}set context(t){this.setHook(t),this._context=t}get context(){return this._context}setHook(t){let e=this.channel;e&&e.hook(this,t)}_reduceCalls(){void 0!==this.calls&&--this.calls<1&&this.remove()}remove(){let t=this.channel;t&&t.removeSubscriber(this)}setPriority(t){let e=this.channel;e&&e.setPriority(this,t)}run(t){this.channel.stopped||"function"==typeof this.predicate&&!this.predicate.apply(this.context,t)||(this._reduceCalls(),this.fn.apply(this.context,t))}}class e{constructor(t,e,n,i){this.namespace=t||"",this._subscribers=[],this._channels=new Map,this._parent=e,this.stopped=!1,this.context=n,this.hook=i}addSubscriber(e,n,i=this.context){return new t(e,n,i,this)}stopPropagation(){this.stopped=!0}setPriority(t,e){let n=this._subscribers;n.indexOf(t)!==-1&&n.splice(n.indexOf(t),1),void 0!==e&&e<this._subscribers.length?n.splice(e,0,t):n.push(t)}hasChannel(t){return this._channels.has(t)}getChannel(t){return this._channels.get(t)}setChannel(t,n){if(this.hasChannel(t)||n)return this.getChannel(t);{let n=new e((this.namespace?this.namespace+":":"")+t,this,this.context,this.hook);return this._channels.set(t,n),n}}returnChannel(t,e){if(t&&t.length>0){let n=t.shift(),i=this.setChannel(n,e);return i&&t.length>0?i.returnChannel(t,e):i}}removeSubscriber(t){let e=this._subscribers,n=e.indexOf(t);t?n!==-1&&e.splice(n,1):e.splice(0,e.length),0===this._subscribers.length&&this._parent&&this._parent.removeChannel(this)}removeChannel(t){t===this.getChannel(t.namespace)&&this._channels.delete(t.namespace)}clear(){this._channels.forEach(t=>t.clear()),this.removeSubscriber()}publish(t){this._subscribers.slice().forEach(e=>e.run(t)),this._parent&&this._parent.publish(t),this.stopped=!1}}class n{constructor(t={},i=(()=>{})){if(!(this instanceof n))return new n(t,i);this.channel=new e("",!1,t,i)}getChannel(t,e){let n=t.split(":");if(n.length>0)return this.channel.returnChannel(n,e)}subscribe(t,e,n={},i){if(t&&""!==t){let r=this.getChannel(t,!1);return r.addSubscriber(e,n,i)}throw Error("Namespace should be provided!")}once(t,e,n={},i){return n.calls=1,this.subscribe(t,e,n,i)}publish(t,...e){if(t&&""!==t){let n=this.getChannel(t,!0);n&&n.namespace===t&&(e.push(n),n.publish(e))}}clear(){this.channel.clear()}}return n.prototype.on=n.prototype.subscribe,n.prototype.trigger=n.prototype.publish,n.version="0.9.9",n}),function(t,e){"function"==typeof define&&define.amd?define("router/utils",[],e):"object"==typeof exports&&(module.exports=e())}(0,function(){"use strict";function t(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}}function e(t,e){t.split("&").forEach(t=>{let n=t.split("=");e(n.shift(),n.join("="))})}function n(n){let i={};return n&&e(n,(e,n)=>{n=t(n),i[e]?"string"==typeof i[e]?i[e]=[i[e],n]:i[e].push(n):i[e]=n}),i}function i(t){let e=[];for(let n in t)t.hasOwnProperty(n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")}function r(t,e){return{getQuery(){return t.query},getLocation(n="",r){let o,s=t.root.substring(0,t.root.length-e.length);return o=r===!0?i(t.query):r===!1?"":i(r),s+n+(0===o.length?"":"?"+o)}}}function o(t,e){if(!e)return!1;if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!o(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}function s(t){let e=(...t)=>(e,n)=>t.map(t=>e.indexOf(t)).filter(t=>t===n).length>0,n=t.toString().replace(c,""),i=e("(","function (","function(")(n,0)?n.indexOf("(")+1:0,r=e("=>")(n,-1)?n.indexOf(")"):n.indexOf("=>"),o=n.slice(i,r).trim(),s=o.match(a);return null===s?[]:s.map(t=>t.replace(/[\s,]/g,""))}const c=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,a=/(?:^|,)\s*([^\s,=]+)/g;return{serialize:i,getLocation:r,equals:o,setQuery:n,getArgs:s}}),function(t,e){"function"==typeof define&&define.amd?define("router/MatchBinding",["./utils"],e):"object"==typeof exports&&(module.exports=e(require("./utils")))}(0,function(t){"use strict";class e{constructor(t,n,i){if(i&&(this.binder=i),""===n)this.pattern=t.replace(/^\(\/\)/g,"").replace(/^\/|$/g,"");else{let e=t.match(/^(\/|\(\/)/g);null===e&&(t="("===t[0]?"(/"+t.substring(1):"/"+t),this.pattern=t}let r=this.pattern.replace(e.ESCAPE_PARAM,"\\$&").replace(e.OPTIONAL_PARAM,"(?:$1)?").replace(e.NAMED_PARAM,function(t,e){return e?t:"([^/]+)"}).replace(e.SPLAT_PARAM,"(.*)");this.patternRegExp=new RegExp("^"+r),this.routeHandler=new Set,this.leaveHandler=new Set,this.queryHandler=new Set,this._active=!1}setRoutes(t){var e=this.subBinder;return t({match:e.match.bind(e)}),this}reTrigger(){this.binder.reTrigger()}match(t){var e=this.subBinder;return t(e.match.bind(e)),this}to(t){return this.routeHandler.add({handler:t,done:!1}),this.reTrigger(),this}leave(e){var n=t.getArgs(e);return this.leaveHandler.add({handler:e,done:n.length>0&&"done"===n[0]}),this}query(t){return this.queryHandler.add({handler:t,done:!1}),this}remove(){return this.routeHandler.clear(),this.leaveHandler.clear(),this.queryHandler.clear(),this.subBinder.remove(),this}test(t){return this.patternRegExp.test(t)}getFragment(t){let e=t.match(this.patternRegExp);return null===e?"":t.substring(e[0].length)}extractParams(t){let e=this.patternRegExp.exec(t);return e&&e.length>0?e.slice(1).map(function(t){return t?decodeURIComponent(t):null}):[]}setSubBinder(t,e,n){let i=new t(e,this);return this.subBinder=i,"function"==typeof n&&n(i.match.bind(i)),i}checkSegment(e,n){let i=[];if(this._active){
let r=this.pattern.replace(/\((.*?)\)/g,"$1").replace(/^\//,"").split("/"),o=this.prevLoc.replace(/^\//,"").split("/"),s=e.slice(0,r.length),c=o.slice(0,r.length),a=t.equals(s,c);a?e.length>1?i=this.subBinder.checkStatus(e.slice(r.length),n):a&&(i=this.subBinder.clearActive(n)):i=this.clearActive(n)}return i}clearActive(t){let e=[];return this._active&&e.push({handler:this.triggerLeave(t),disable:this.disable.bind(this)}),e.concat(this.subBinder.clearActive())}disable(){this._active=!1}triggerTo(e,n){if(this.test(e)){if(!this._active){this.prevLoc=e;let i=this.extractParams(e).concat(t.getLocation(n,e));this.applyHandlers(this.routeHandler,i),this._active=!0}this.applyHandlers(this.queryHandler,[t.getLocation(n,e)]);let i=this.getFragment(e);if(""!==i.trim()){let t=this.subBinder;t&&t.triggerRoutes(i,n)}}}applyHandlers(t,e=[]){t&&t.size>0&&t.forEach(t=>{t.handler.apply(this,e)})}triggerLeave(e){return new Promise(n=>{let i=this.leaveHandler,r=t.getLocation(e,this.prevLoc),o=0,s=!1;i&&i.size>0&&i.forEach(t=>{t.done&&o++,t.handler((done=!0)=>{done?0!==--o||s||n(!0):done||s||(s=!0,n(!1))},r)}),0===o&&n(!0)})}}return Object.assign(e,{OPTIONAL_PARAM:/\((.*?)\)/g,NAMED_PARAM:/(\(\?)?:\w+/g,SPLAT_PARAM:/\*\w+/g,ESCAPE_PARAM:/[\-{}\[\]+?.,\\\^$|#\s]/g}),e}),function(t,e){"function"==typeof define&&define.amd?define("router/MatchBinder",["./MatchBinding"],e):"object"==typeof exports?module.exports=e(require("./MatchBinding")):(t.UrlManager=t.UrlManager||{},t.UrlManager.MatchBinder=e(t.UrlManager.MatchBinding))}(this,function(t){"use strict";class e{constructor(t,e){this._parent=e,this.bindings=new Set,this.location=t||"",this._active=!1}reTrigger(){this._parent.reTrigger()}match(t,e){return"function"==typeof t&&(e=t,t=!1),""===t&&(t=!1),this.getMatchBinding(t,e)}getMatchBinding(n,i){if(n){let r=new t(n,this.location,this);return r.setSubBinder(e,this.location+(n||""),i),this.bindings.add(r),r}return"function"==typeof i&&i(this.match.bind(this)),{match:this.match.bind(this)}}clearActive(t,e){let n=[];return this.bindings.size>0&&this.bindings.forEach(i=>{n=n.concat(i.clearActive(t,e))}),n}checkStatus(t,e){let n=[];return this.bindings.size>0&&this.bindings.forEach(i=>{n=n.concat(i.checkSegment(t,e))}),n}remove(){this.bindings.size>0&&this.bindings.forEach(t=>t.remove())}triggerRoutes(t,e){this.bindings.size>0&&this.bindings.forEach(n=>n.triggerTo(t,e))}}return e}),function(t,e){"function"==typeof define&&define.amd?define("router/Router",["./MatchBinder","./utils"],e):"object"==typeof exports&&(module.exports=e(require("./MatchBinder"),require("./utils")))}(0,function(t,e){"use strict";class n{constructor(t){void 0!==t&&""!==t&&(this._location=t.replace(/^\/|\/$/g,"")+"/"),this.root=this.getBinder(),this._listeners=new Set,this._handlers=new Set}getBinder(){return new t("",this)}test(t){return new RegExp("^"+this._location,"g").test(t)}getLocation(t){let e=t.replace(/^\/|$/g,"");return void 0!==this._location?!!this.test(e)&&e.replace(this._location,""):e}reTrigger(){this.currLocation&&this.trigger(this.currLocation)}trigger(t){if(this.started){this.currLocation=t;let n=t.split("?",2),i=this.getLocation(n[0]);if(i||""===i){let t=e.setQuery(n[1]),r={root:i,query:t};this.execute(i,r).then(t=>this.setRoutes(t,i,r)).then(t=>this.setLocation(t))}}}execute(t,e){return new Promise(n=>{let i=t.replace(/^\/|$/g,"").split("/"),r=this.root,o=r.checkStatus(i,e);o.length>0?o.forEach(t=>{t.handler.then(e=>{t.triggered||(t.triggered=!0,t.applied=e,o.filter(t=>t.applied).length===o.length?(o.forEach(t=>t.disable()),n(!0)):o.filter(t=>t.triggered).length===o.length&&n(!1))})}):n(!0)})}setRoutes(t,e,n){return t&&(this._handlers.forEach(t=>t()),this.root.triggerRoutes(e,n)),t}setListener(t){let e=this._listeners;return e.add(t),{remove(){e.delete(t)}}}onRouteChange(t){let e=this._handlers;return e.add(t),{remove(){e.delete(t)}}}setLocation(t){let e=t?this.currLocation:this.prevLocation;this.prevLocation=e,this._listeners.forEach(n=>n(e,t))}match(t){t(this.root.match.bind(this.root))}start(){this.started=!0}stop(){this.started=!1}}return n}),define("widget/App",["./Mediator","router/Router"],function(t,e){"use strict";function n(t,e){function n(){let e=window.location.href.match(/#(.*)$/),n=e?e[1]:"";i!==n&&t.trigger(n)}var i="";t.setListener((t,e)=>{i=t,e||(window.location.hash=t)}),t.onRouteChange(()=>{e.size>0&&(e.forEach(t=>t()),e.clear())}),t.start(),window.addEventListener("hashchange",n,!1),n()}class i{static extend(t={}){class e extends i{}return Object.assign(e.prototype,t),e}constructor(t={}){this.options=t,this.beforeInit(...arguments)}beforeInit(){}init(){}setContext(){return{}}set context(i){let r=new e(this.options.rootRoute);r.match(e=>{Object.assign(i,{eventBus:new t(this.context,(t,e)=>{e._globalEvents=e._globalEvents||[],e._globalEvents.indexOf(t)===-1&&e._globalEvents.push(t)}),active:new Map,match:e,container:this.el,_cssReady:i._cssReady||[]}),n(r,i.active),this._context=i})}get context(){return this._context}start(t){if(t instanceof HTMLElement!=!0)throw Error("Contaner should be a HTML element");{this.el=t,this.context=this.setContext(...arguments),void 0!==this.AppContainer&&(this.appContainer=new this.AppContainer),this.init(this.options);let e=document.createElement("div");this.el.appendChild(e),this.appContainer.ready(e),this.appContainer.setContext(this.context),setTimeout(()=>{t.classList.add("show")},100)}}}return i});