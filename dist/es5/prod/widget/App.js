/*! stonewalljs 2016-04-15 */
"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();define("templating/utils/List",[],function(){var a=function(){function a(b){_classCallCheck(this,a),this._map=new Map(b),this._indexes=[].concat(_toConsumableArray(this._map.keys())),this._onDelete=[]}return _createClass(a,[{key:"keys",value:function(){return this._indexes}},{key:"values",value:function(){return this.entries().map(function(a){return a[1]})}},{key:"entries",value:function(){var a=this;return this._indexes.map(function(b){return[b,a._map.get(b)]})}},{key:"get",value:function(a){return this._map.get(a)}},{key:"forEach",value:function(a){return this.values().forEach(function(b,c){for(var d=arguments.length,e=Array(d>2?d-2:0),f=2;d>f;f++)e[f-2]=arguments[f];return a.apply(null,[b,c].concat(e))})}},{key:"getIndex",value:function(a){return this._indexes.indexOf(a)}},{key:"changeIndex",value:function(a,b){if(a){var c=this._indexes,d=c.indexOf(a);-1!==d&&b!==d&&this._indexes.splice(b,0,this._indexes.splice(d,1)[0])}}},{key:"getValueByIndex",value:function(a){return this._map.get(this._indexes[a])}},{key:"getKeyByIndex",value:function(a){return this._indexes[a]}},{key:"set",value:function(a,b,c){this._map.set(a,b),void 0!==c?this._indexes.splice(c,0,a):this._indexes.push(a)}},{key:"has",value:function(a){return this._map.has(a)}},{key:"clear",value:function(){this._map.clear(),this._indexes.splice(0,this._indexes.length)}},{key:"onDelete",value:function(a){var b=function(){return a.apply(void 0,arguments)};return this._onDelete.push(b),{remove:function(){this._onDelete.splice(this._onDelete.indexOf(b,1))}}}},{key:"delete",value:function(a){var b=this;this.has(a)&&!function(){var c=b._map.get(a);b._map["delete"](a),b._indexes.splice(b._indexes.indexOf(a),1),b._onDelete.forEach(function(d){return d(a,b.size,c)})}()}},{key:"deleteByIndex",value:function(a){this["delete"](this._indexes[a])}},{key:"first",get:function(){return this.getValueByIndex(0)}},{key:"last",get:function(){return this.getValueByIndex(this._indexes.length-1)}},{key:"size",get:function(){return this._map.size}}]),a}();return a}),define("templating/dom",[],function(){function a(a){var b="undefined"==typeof a?"undefined":_typeof(a);return"function"===b||"object"===b&&!!a}function b(a){var b=document.createElement(a||"div");return b.setAttribute("style","display:none;"),b}function c(a){var b=Object.keys(a);b.length>0&&b.forEach(function(b){if("root"!==b){var c=a[b];void 0!==c.elGroup&&c.elGroup.size>0&&c.elGroup.forEach(function(a){void 0!==a&&void 0!==a.remove&&a.remove(!0)})}})}var d=function(){function a(b,c){_classCallCheck(this,a),this.el=b,this._events=[],this.name=c.name||c.data.name;var d=this.data=c.data;d&&d.bind&&(this.bind=d.bind)}return _createClass(a,[{key:"clone",value:function(){return this.run.apply(this,arguments)}},{key:"text",value:function(a){e.text(this,a)}},{key:"detach",value:function(){e.detach(this)}},{key:"attach",value:function(){e.attach(this)}},{key:"changePosition",value:function(a){e.changePosition(this,a)}},{key:"setAttribute",value:function(a,b){e.setAttribute(this,a,b)}},{key:"getAttribute",value:function(a){return e.getAttribute(this,a)}},{key:"removeAttribute",value:function(a){e.removeAttribute(this,a)}},{key:"setStyle",value:function(a,b){e.setStyle(this,a,b)}},{key:"getStyle",value:function(a){return e.getStyle(this,a)}},{key:"removeStyle",value:function(a){e.removeStyle(this,a)}},{key:"addClass",value:function(a){e.addClass(this,a)}},{key:"hasClass",value:function(a){return e.hasClass(this,a)}},{key:"removeClass",value:function(a){e.removeClass(this,a)}},{key:"val",value:function(a){return e.val(this,a)}},{key:"on",value:function(a,b,c){var d=Array.prototype.slice.call(arguments,0);return e.on.apply(!1,[this].concat(d))}},{key:"onDOMAttached",value:function(){return e.onDOMAttached(this)}},{key:"remove",value:function(a){e.remove(this,a)}}]),a}(),e={detach:function(a){a.placeholder instanceof HTMLElement==!1&&(a.placeholder=b(a.data.tag||a.el.tagName)),a&&a.el&&a.el.parentNode&&a.el.parentNode.replaceChild(a.placeholder,a.el)},attach:function(a){a&&a.el&&a.placeholder&&a.placeholder.parentNode&&a.placeholder.parentNode.replaceChild(a.el,a.placeholder)},append:function(a,b){void 0!==a.el&&void 0!==b.el&&a.el.appendChild(b.el)},prepend:function(a,b){e.insertBefore(a,b,0)},insertBefore:function(a,b,c){var d=a.el,e=b.el;void 0!==d&&void 0!==e&&(void 0!==d.childNodes[c]?d.insertBefore(e,d.childNodes[c]):d.appendChild(e))},changePosition:function(a,b){var c=a.el;if(c&&c.parentNode){var d=c.parentNode,e=a.elGroup,f=e.size,g=e.getKeyByIndex(b)||e.getLast();g!==c&&(f-1>=b?d.insertBefore(c,g):null!==g.nextSibling?d.insertBefore(c,g.nextSibling):d.appendChild(c),a.elGroup.changeIndex(c,b))}},text:function(a,b){a&&a.el&&(a.el.innerHTML=b)},setAttribute:function(b,c,d){b&&b.el&&(a(c)?Object.keys(c).forEach(function(a){b.el.setAttribute(a,c[a])}):b.el.setAttribute(c,d))},getAttribute:function(a,b){return a&&a.el?a.el.getAttribute(b):void 0},removeAttribute:function(a,b){a&&a.el&&a.el.removeAttribute(b)},setStyle:function(b,c,d){b&&b.el&&(a(c)?Object.keys(c).forEach(function(a){b.el.style[a]=c[a]}):b.el.style[c]=d)},getStyle:function(a,b){return a&&a.el&&void 0!==a.el&&void 0!==a.el.style?a.el.style[b]:void 0},removeStyle:function(a,b){a&&a.el&&(a.el.style[b]="")},addClass:function(a,b){a&&a.el&&a.el.classList.add(b)},hasClass:function(a,b){return a&&a.el?a.el.classList.contains(b):!1},removeClass:function(a,b){a&&a.el&&a.el.classList.remove(b)},val:function(a,b){if(a&&a.el){var c=a.el;if(void 0===b)return c.value;c.value=b}},on:function(a,b,c,d){for(var e=arguments.length,f=Array(e>4?e-4:0),g=4;e>g;g++)f[g-4]=arguments[g];var h=this,i=a.el,j=b.split(" "),k=function(b){c.apply(d||h,[b,a].concat(f))};j.forEach(function(a){i.addEventListener(a,k)});var l={remove:function(){j.forEach(function(a){return i.removeEventListener(a,k)});var b=a._events;b.splice(b.indexOf(l),1)}};return a._events.push(l),l},remove:function(a){for(;a._events.length>0;)a._events.shift().remove();a.children&&c(a.children),void 0!==a.elGroup&&a.elGroup["delete"](a.el),void 0!==a.el&&(a.el.remove?a.el.remove():a.el.parentNode&&a.el.parentNode.removeChild(a.el),delete a.el)},onDOMAttached:function(a){var b=this,c=[],d=!1,e=void 0;return void 0!==a.el&&(e=function(){if(d)for(;c.length>0;)c.shift()();else window.requestAnimationFrame(e),document.body.contains(a.el)&&(d=!0)}),{then:function(a,d){c.push(a.bind(d||b)),window.requestAnimationFrame(e)}}},Element:d};return e}),function(a,b){"function"==typeof define&&define.amd?define("templating/DomFragment",b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b())}(void 0,function(){function a(a){var b=document.createElement(a||"div");return b.setAttribute("style","display:none;"),b}var b=function(){function b(a,c,d,e,f,g){return _classCallCheck(this,b),Object.assign(this,{_node:a,placeholder:c,childNodes:d,elGroup:e,index:f,obj:g}),this.render()}return _createClass(b,[{key:"applyAttributes",value:function(a){var b=this._node.data.attribs;Object.keys(b).forEach(function(c){a.setAttribute(c,b[c])})}},{key:"applyFragment",value:function(a){var b=this._node,c=b.template();if(void 0!==c)for(;c.childNodes.length>0;)a.appendChild(c.childNodes[0])}},{key:"appendToBody",value:function(a){var b=this.elGroup,c=this.placeholder,d=b.size;if(d>0){var e=void 0===this.index||this.index>d-1?d-1:this.index-1,f=b.keys()[-1!==e?e:0],g=f.parentNode;-1===e?g.insertBefore(a,f):null!==f.nextSibling?g.insertBefore(a,f.nextSibling):g.appendChild(a)}else{var h=c.parentNode;h&&h.replaceChild(a,c)}}},{key:"render",value:function(){var b=this.placeholder,c=this._node,d=!b.id&&0===this.elGroup.size,e=c.tmpEl(d?b:!1,this.obj,this.childNodes,c),f=e.el||a(c.data.tag);return d||c.replace?c.replace||(f.innerHTML=""):this.applyAttributes(f),c.replace||this.applyFragment(f),this.appendToBody(f),e.ready&&e.ready(f),e}}]),b}();return b}),function(a,b){"function"==typeof define&&define.amd?define("templating/Decoder",["./utils/List","./dom","./DomFragment"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./utils/List"),require("./dom"),require("./DomFragment")))}(void 0,function(a,b,c){function d(a){return a===Object(a)}function e(a){return Array.isArray?Array.isArray(a):"[object Array]"===toString.call(a)}var f={},g=function(){function g(a){_classCallCheck(this,g),this._root="string"==typeof a?JSON.parse(a):a,a.children&&a.children.length>0&&(this.children=this._parseElements(a.children))}return _createClass(g,null,[{key:"addDecoder",value:function(a){void 0===f[a.tagName]&&(f[a.tagName]=a)}}]),_createClass(g,[{key:"renderFragment",value:function(a){var b=document.createElement("template");return b.innerHTML=a,void 0!==b.content?b.content.firstChild:b.firstChild}},{key:"_parseElements",value:function(a){var b=this,c={};return a.forEach(function(a){var d=a.data.name,e=a.tagName;if(e){var g=f[e].decode(a);if(g){var h={name:g.name,data:g.data,tmpEl:g.tmpEl,parse:g.parse,replace:g.replace,id:a.id,template:function(){return b.renderFragment(a.template,a.data.tag)},noAttach:f[e].noAttach||a.data.tplSet.noattach};a.children&&a.children.length>0&&(h.children=b._parseElements(a.children)),c[d]=h}}else d&&(c[d]={id:a.id,data:a.data,name:d})}),c}},{key:"renderTemplate",value:function(){var f=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],g=this,h=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=arguments[2],j={},k=[];Object.keys(f).forEach(function(l){var m=f[l],n=m.children,o=new a,p=document.createElement(m.data.tplSet.tag||"div");if(p.setAttribute("style","display:none;"),p.id=m.id,o.onDelete(function(a,b){0===b&&a.parentNode&&(a.parentNode.replaceChild(p,a),i=function(){return p})}),m.template)!function(){var a=function b(a,f){var j=i();a instanceof HTMLElement==!0&&(j=a);var k=void 0,l=j!==a&&(d(a)||e(a))?a:h;if(!m.noAttach||a){var p=j.querySelector("#"+m.id)||j;n&&(k=g.renderTemplate(n,l,function(){return j}));var q=new c(m,p,k,o,f,l);return j=q.el,k&&k.runAll&&m.parse&&k.runAll(),k&&!q.children&&(q.children=k),q.elGroup=o,q.run=b,o.set(q.el,q,f),q}};k.push(a),j[l]={data:m.data,run:a,elGroup:o}}();else{var q=new b.Element(i().querySelector("#"+m.id),m);q.removeAttribute("id"),q.elGroup=o,o.set(q.el,q),j[l]=q}});var l=function(a,b,c){Object.defineProperty(a,b,{enumerable:!1,value:c})},m=function(a){return k.forEach(function(b){return b(a)}),j};return l(j,"runAll",m),j}},{key:"render",value:function(a){var b=this.renderFragment(this._root.template);return{fragment:b,children:this.renderTemplate(this.children,a,function(){return b}).runAll(),templateId:this._root.templateId}}}]),g}();return g}),function(a,b){"function"==typeof define&&define.amd?define("coders/component/cpDecoder",["templating/Decoder"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./Decoder")))}(void 0,function(a){var b={tagName:"cp",decode:function(a){var b=a.data,c={name:b.name,replace:!0,tmpEl:function(a,c,d,e){var f=new b.src(b.dataset,d,c,e);return f},data:b||{}};return void 0!==b.dataset.bind&&(c.bind=b.dataset.bind),c}};return a&&a.addDecoder(b),b}),function(a,b){"function"==typeof define&&define.amd?define("coders/placeholders/plDecoder",["templating/Decoder","templating/dom"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./Decoder"),require("./dom")))}(void 0,function(a,b){var c={tagName:"pl",decode:function(a){var c=a.data;return{name:c.name,tmpEl:function(a,d,e,f){return new b.Element(a||document.createElement(c.tag),f)},parse:!0,data:c}}};return a&&a.addDecoder(c),c}),function(a,b){"function"==typeof define&&define.amd?define("coders/databind/bdDecoder",["templating/Decoder","templating/dom"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./Decoder"),require("./dom")))}(void 0,function(a,b){var c={tagName:"bd",noAttach:!0,decode:function(a){var c=this.data=a.data,d={name:c.name,tmpEl:function(a,d,e,f){return new b.Element(a||document.createElement(c.tag),f)},data:c};return d}};return a&&a.addDecoder(c),c}),function(a,b){"function"==typeof define&&define.amd?define("coders/router/routerDecoder",["templating/Decoder","templating/dom"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./Decoder"),require("./dom")))}(void 0,function(a,b){var c={tagName:"rt",noAttach:!0,decode:function(a){var c=a.data,d={name:c.name,tmpEl:function(a,d,e,f){return new b.Element(a||document.createElement(c.tag),f)},parse:!0,data:c||{}};return d}};return a&&a.addDecoder(c),c}),function(a,b){"function"==typeof define&&define.amd?define("coders/style/styleDecoder",["templating/Decoder"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./Decoder")))}(void 0,function(a){var b={tagName:"style",decode:function(a){if(void 0===a.data.styleAttached){a.data.styleAttached=!0;var b=document.createElement("style");b.innerHTML=a.data.style,document.head.appendChild(b)}}};return a&&a.addDecoder(b),b}),function(a,b){"function"==typeof define&&define.amd?define("widget/Mediator",[],function(){return b()}):"undefined"!=typeof exports?exports.Mediator=b():a.Mediator=b()}(void 0,function(){var a=function(){function a(b,c){var d=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],e=arguments.length<=3||void 0===arguments[3]?null:arguments[3];_classCallCheck(this,a),this.fn=b,this.channel=e,this.context=d,this.options=c}return _createClass(a,[{key:"update",value:function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Object.assign(this,a),this.channel&&this.setPriority(this.priority)}},{key:"setHook",value:function(a){var b=this.channel;b&&b.hook(this,a)}},{key:"_reduceCalls",value:function(){void 0!==this.calls&&(this.calls--,this.calls<1&&this.remove())}},{key:"remove",value:function(){var a=this.channel;a&&a.removeSubscriber(this)}},{key:"setPriority",value:function(a){var b=this.channel;b&&b.setPriority(this,a)}},{key:"run",value:function(a){this.channel.stopped||"function"==typeof this.predicate&&!this.predicate.apply(this.context,a)||(this._reduceCalls(),this.fn.apply(this.context,a))}},{key:"options",set:function(a){this.update(a)}},{key:"context",set:function(a){this.setHook(a),this._context=a},get:function(){return this._context}}]),a}(),b=function(){function b(a,c,d,e){_classCallCheck(this,b),this.namespace=a||"",this._subscribers=[],this._channels=new Map,this._parent=c,this.stopped=!1,this.context=d,this.hook=e}return _createClass(b,[{key:"addSubscriber",value:function(b,c){var d=arguments.length<=2||void 0===arguments[2]?this.context:arguments[2];return new a(b,c,d,this)}},{key:"stopPropagation",value:function(){this.stopped=!0}},{key:"setPriority",value:function(a,b){var c=this._subscribers,d=c.indexOf(a);-1!==d&&c.splice(c.indexOf(a),1),void 0!==b&&b<this._subscribers.length?c.splice(b,0,a):c.push(a)}},{key:"hasChannel",value:function(a){return this._channels.has(a)}},{key:"getChannel",value:function(a){return this._channels.get(a)}},{key:"setChannel",value:function(a,c){if(this.hasChannel(a)||c)return this.getChannel(a);var d=new b((this.namespace?this.namespace+":":"")+a,this,this.context,this.hook);return this._channels.set(a,d),d}},{key:"returnChannel",value:function c(a,b){if(a&&a.length>0){var d=a.shift(),c=this.setChannel(d,b);return c&&a.length>0?c.returnChannel(a,b):c}}},{key:"removeSubscriber",value:function(a){var b=this._subscribers,c=b.indexOf(a);a?-1!==c&&b.splice(c,1):b.splice(0,b.length),0===this._subscribers.length&&this._parent&&this._parent.removeChannel(this)}},{key:"removeChannel",value:function(a){a===this.getChannel(a.namespace)&&this._channels["delete"](a.namespace)}},{key:"clear",value:function(){this._channels.forEach(function(a){return a.clear()}),this.removeSubscriber()}},{key:"publish",value:function(a){this._subscribers.slice().forEach(function(b){return b.run(a)}),this._parent&&this._parent.publish(a),this.stopped=!1}}]),b}(),c=function(){function a(){var c=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],d=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return _classCallCheck(this,a),this instanceof a?void(this.channel=new b("",!1,c,d)):new a(c,d)}return _createClass(a,[{key:"getChannel",value:function(a,b){var c=a.split(":");return c.length>0?this.channel.returnChannel(c,b):void 0}},{key:"subscribe",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],d=arguments[3];if(a&&""!==a){var e=this.getChannel(a,!1);return e.addSubscriber(b,c,d)}throw Error("Namespace should be provided!")}},{key:"once",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],d=arguments[3];return c.calls=1,this.subscribe(a,b,c,d)}},{key:"publish",value:function(a){if(a&&""!==a){var b=this.getChannel(a,!0);if(b&&b.namespace===a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];d.push(b),b.publish(d)}}}},{key:"clear",value:function(){this.channel.clear()}}]),a}();return c.prototype.on=c.prototype.subscribe,c.prototype.trigger=c.prototype.publish,c.version="0.9.9",c}),function(a,b){"function"==typeof define&&define.amd?define("router/utils",[],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b())}(void 0,function(){function a(a){try{return decodeURIComponent(a.replace(/\+/g," "))}catch(b){return a}}function b(a,b){var c=a.split("&");c.forEach(function(a){var c=a.split("=");b(c.shift(),c.join("="))})}function c(c){var d={};return c&&b(c,function(b,c){c=a(c),d[b]?"string"==typeof d[b]?d[b]=[d[b],c]:d[b].push(c):d[b]=c}),d}function d(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function e(a,b){return{getQuery:function(){return a.query},getLocation:function(){var c=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments[1],f=a.root.substring(0,a.root.length-b.length),g=void 0;return g=e===!0?d(a.query):e===!1?"":d(e),f+c+(0===g.length?"":"?"+g)}}}function f(a,b){if(!b)return!1;if(a.length!==b.length)return!1;for(var c=0,d=a.length;d>c;c++)if(a[c]instanceof Array&&b[c]instanceof Array){if(!f(a[c],b[c]))return!1}else if(a[c]!==b[c])return!1;return!0}function g(a){var b=a.toString().replace(h,""),c=b.slice(b.indexOf("(")+1,b.indexOf(")")),d=c.match(i);return null===d?[]:d.map(function(a){return a.replace(/[\s,]/g,"")})}var h=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,i=/(?:^|,)\s*([^\s,=]+)/g;return{serialize:d,getLocation:e,equals:f,setQuery:c,getArgs:g}}),function(a,b){"function"==typeof define&&define.amd?define("router/MatchBinding",["./utils"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./utils")))}(void 0,function(a){var b=function(){function b(a,c,d){if(_classCallCheck(this,b),d&&(this.binder=d),""===c)this.pattern=a.replace(/^\(\/\)/g,"").replace(/^\/|$/g,"");else{var e=a.match(/^(\/|\(\/)/g);null===e&&(a="("===a[0]?"(/"+a.substring(1):"/"+a),this.pattern=a}var f=this.pattern.replace(b.ESCAPE_PARAM,"\\$&").replace(b.OPTIONAL_PARAM,"(?:$1)?").replace(b.NAMED_PARAM,function(a,b){return b?a:"([^/]+)"}).replace(b.SPLAT_PARAM,"(.*)");this.patternRegExp=new RegExp("^"+f),this.routeHandler=new Set,this.leaveHandler=new Set,this.queryHandler=new Set,this._active=!1}return _createClass(b,[{key:"setRoutes",value:function(a){var b=this.subBinder;return a({match:b.match.bind(b)}),this}},{key:"reTrigger",value:function(){this.binder.reTrigger()}},{key:"match",value:function(a){var b=this.subBinder;return a(b.match.bind(b)),this}},{key:"to",value:function(a){return this.routeHandler.add({handler:a,done:!1}),this.reTrigger(),this}},{key:"leave",value:function(b){var c=a.getArgs(b);return this.leaveHandler.add({handler:b,done:c.length>0&&"done"===c[0]}),this}},{key:"query",value:function(a){return this.queryHandler.add({handler:a,done:!1}),this}},{key:"remove",value:function(){return this.routeHandler.clear(),this.leaveHandler.clear(),this.queryHandler.clear(),this.subBinder.remove(),this}},{key:"test",value:function(a){return this.patternRegExp.test(a)}},{key:"getFragment",value:function(a){var b=a.match(this.patternRegExp);return null===b?"":a.substring(b[0].length)}},{key:"extractParams",value:function(a){var b=this.patternRegExp.exec(a);return b&&b.length>0?b.slice(1).map(function(a){return a?decodeURIComponent(a):null}):[]}},{key:"setSubBinder",value:function(a,b,c){var d=new a(b,this);return this.subBinder=d,"function"==typeof c&&c(d.match.bind(d)),d}},{key:"checkSegment",value:function(b,c){var d=[];if(this._active){var e=this.pattern.replace(/\((.*?)\)/g,"$1").replace(/^\//,"").split("/"),f=this.prevLoc.replace(/^\//,"").split("/"),g=b.slice(0,e.length),h=f.slice(0,e.length),i=a.equals(g,h);i?b.length>1?d=this.subBinder.checkStatus(b.slice(e.length),c):i&&(d=this.subBinder.clearActive(c)):d=this.clearActive(c)}return d}},{key:"clearActive",value:function(a){var b=[];return this._active&&b.push({handler:this.triggerLeave(a),disable:this.disable.bind(this)}),b.concat(this.subBinder.clearActive())}},{key:"disable",value:function(){this._active=!1}},{key:"triggerTo",value:function(b,c){if(this.test(b)){if(!this._active){this.prevLoc=b;var d=this.extractParams(b).concat(a.getLocation(c,b));this.applyHandlers(this.routeHandler,d),this._active=!0}this.applyHandlers(this.queryHandler,[a.getLocation(c,b)]);var e=this.getFragment(b);if(""!==e.trim()){var f=this.subBinder;f&&f.triggerRoutes(e,c)}}}},{key:"applyHandlers",value:function(a){var b=this,c=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];a&&a.size>0&&a.forEach(function(a){a.handler.apply(b,c)})}},{key:"triggerLeave",value:function(b){var c=this;return new Promise(function(d){var e=c.leaveHandler,f=a.getLocation(b,c.prevLoc),g=0,h=!1;e&&e.size>0&&e.forEach(function(a){a.done&&g++,a.handler(function(){var a=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];a?(g--,0!==g||h||d(!0)):a||h||(h=!0,d(!1))},f)}),0===g&&d(!0)})}}]),b}();return Object.assign(b,{OPTIONAL_PARAM:/\((.*?)\)/g,NAMED_PARAM:/(\(\?)?:\w+/g,SPLAT_PARAM:/\*\w+/g,ESCAPE_PARAM:/[\-{}\[\]+?.,\\\^$|#\s]/g}),b}),function(a,b){"function"==typeof define&&define.amd?define("router/MatchBinder",["./MatchBinding"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=b(require("./MatchBinding")):(a.UrlManager=a.UrlManager||{},a.UrlManager.MatchBinder=b(a.UrlManager.MatchBinding))}(void 0,function(a){var b=function(){function b(a,c){_classCallCheck(this,b),this._parent=c,this.bindings=new Set,this.location=a||"",this._active=!1}return _createClass(b,[{key:"reTrigger",value:function(){this._parent.reTrigger()}},{key:"match",value:function(a,b){return"function"==typeof a&&(b=a,a=!1),""===a&&(a=!1),this.getMatchBinding(a,b)}},{key:"getMatchBinding",value:function(c,d){if(c){var e=new a(c,this.location,this);return e.setSubBinder(b,this.location+(c||""),d),this.bindings.add(e),e}return"function"==typeof d&&d(this.match.bind(this)),{match:this.match.bind(this)}}},{key:"clearActive",value:function(a,b){var c=[];return this.bindings.size>0&&this.bindings.forEach(function(d){c=c.concat(d.clearActive(a,b))}),c}},{key:"checkStatus",value:function(a,b){var c=[];return this.bindings.size>0&&this.bindings.forEach(function(d){c=c.concat(d.checkSegment(a,b))}),c}},{key:"remove",value:function(){this.bindings.size>0&&this.bindings.forEach(function(a){return a.remove()})}},{key:"triggerRoutes",value:function(a,b){this.bindings.size>0&&this.bindings.forEach(function(c){return c.triggerTo(a,b)})}}]),b}();return b}),function(a,b){"function"==typeof define&&define.amd?define("router/Router",["./MatchBinder","./utils"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./MatchBinder"),require("./utils")))}(void 0,function(a,b){var c=function(){function c(a){_classCallCheck(this,c),void 0!==a&&""!==a&&(this._location=a.replace(/^\/|\/$/g,"")+"/"),this.root=this.getBinder(),this._listeners=new Set,this._handlers=new Set}return _createClass(c,[{key:"getBinder",value:function(){return new a("",this)}},{key:"test",value:function(a){return new RegExp("^"+this._location,"g").test(a)}},{key:"getLocation",value:function(a){var b=a.replace(/^\/|$/g,"");return void 0!==this._location?this.test(b)?b.replace(this._location,""):!1:b}},{key:"reTrigger",value:function(){this.currLocation&&this.trigger(this.currLocation)}},{key:"trigger",value:function(a){var c=this;this.started&&a&&!function(){c.currLocation=a;var d=a.split("?",2),e=c.getLocation(d[0]);(e||""===e)&&!function(){var a=b.setQuery(d[1]),f={root:e,query:a};c.execute(e,f).then(function(a){return c.setRoutes(a,e,f)}).then(function(a){return c.setLocation(a)})}()}()}},{key:"execute",value:function(a,b){var c=this;return new Promise(function(d){var e=a.replace(/^\/|$/g,"").split("/"),f=c.root,g=f.checkStatus(e,b);g.length>0?g.forEach(function(a){a.handler.then(function(b){a.triggered||(a.triggered=!0,a.applied=b,g.filter(function(a){return a.applied}).length===g.length?(g.forEach(function(a){return a.disable()}),d(!0)):g.filter(function(a){return a.triggered}).length===g.length&&d(!1))})}):d(!0)})}},{key:"setRoutes",value:function(a,b,c){return a&&(this._handlers.forEach(function(a){return a()}),this.root.triggerRoutes(b,c)),a}},{key:"setListener",value:function(a){var b=this._listeners;return b.add(a),{remove:function(){b["delete"](a)}}}},{key:"onRouteChange",value:function(a){var b=this._handlers;return b.add(a),{remove:function(){b["delete"](a)}}}},{key:"setLocation",value:function(a){var b=a?this.currLocation:this.prevLocation;this.prevLocation=b,this._listeners.forEach(function(c){return c(b,a)})}},{key:"match",value:function(a){a(this.root.match.bind(this.root))}},{key:"start",value:function(){this.started=!0}},{key:"stop",value:function(){this.started=!1}}]),c}();return c}),define("widget/App",["./Mediator","router/Router"],function(a,b){function c(a,b){function c(){var b=window.location.href.match(/#(.*)$/),c=b?b[1]:"";d!==c&&a.trigger(c)}var d="";a.setListener(function(a,b){d=a,b||(window.location.hash=a)}),a.onRouteChange(function(){b.size>0&&(b.forEach(function(a){return a()}),b.clear())}),a.start(),window.addEventListener("hashchange",c,!1),c()}var d=function(){function d(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,d),this.options=a,this.beforeInit.apply(this,arguments)}return _createClass(d,null,[{key:"extend",value:function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),b}(d);return Object.assign(b.prototype,a),b}}]),_createClass(d,[{key:"beforeInit",value:function(){}},{key:"init",value:function(){}},{key:"setContext",value:function(){return{}}},{key:"start",value:function(a){if(a instanceof HTMLElement!=!0)throw Error("Contaner should be a HTML element");this.context=this.setContext.apply(this,arguments),void 0!==this.AppContainer&&(this.appContainer=new this.AppContainer),this.init.call(this,this.options),this.el=a;var b=document.createElement("div");a.appendChild(b),this.appContainer.ready(b),this.appContainer.setContext(this.context),setTimeout(function(){a.classList.add("show")},100)}},{key:"context",set:function(d){var e=this,f=new b(this.options.rootRoute);f.match(function(b){Object.assign(d,{eventBus:new a(e.context,function(a,b){b._globalEvents=b._globalEvents||[],-1===b._globalEvents.indexOf(a)&&b._globalEvents.push(a)}),active:new Map,match:b}),c(f,d.active),e._context=d})},get:function(){return this._context}}]),d}();return d}),function(a){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=a():"function"==typeof define&&define.amd?define("watch",a):(window.WatchJS=a(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){var a={noMore:!1},b=[],c=function(a){var b={};return a&&"[object Function]"==b.toString.call(a)},d=function(a){return"[object Array]"===Object.prototype.toString.call(a)},e=function(a,b){var c=[],e=[];if("string"!=typeof a&&"string"!=typeof b){if(d(a))for(var f=0;f<a.length;f++)void 0===b[f]&&c.push(f);else for(var f in a)a.hasOwnProperty(f)&&void 0===b[f]&&c.push(f);if(d(b))for(var g=0;g<b.length;g++)void 0===a[g]&&e.push(g);else for(var g in b)b.hasOwnProperty(g)&&void 0===a[g]&&e.push(g)}return{added:c,removed:e}},f=function(a){if(null==a||"object"!=("undefined"==typeof a?"undefined":_typeof(a)))return a;var b=a.constructor();for(var c in a)b[c]=a[c];return b},g=function(a,b,c,d){try{Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})}catch(e){try{Object.prototype.__defineGetter__.call(a,b,c),Object.prototype.__defineSetter__.call(a,b,d)}catch(f){throw new Error("watchJS error: browser not supported :/")}}},h=function(a,b,c){try{Object.defineProperty(a,b,{enumerable:!1,configurable:!0,writable:!1,value:c})}catch(d){a[b]=c}},i=function(){c(arguments[1])?j.apply(this,arguments):d(arguments[1])?k.apply(this,arguments):l.apply(this,arguments)},j=function(a,b,c,e){if("string"!=typeof a&&(a instanceof Object||d(a))){var f=[];if(d(a))for(var g=0;g<a.length;g++)f.push(g);else for(var h in a)"$val"!=h&&Object.prototype.hasOwnProperty.call(a,h)&&f.push(h);k(a,f,b,c,e),e&&w(a,"$$watchlengthsubjectroot",b,c)}},k=function(a,b,c,e,f){if("string"!=typeof a&&(a instanceof Object||d(a)))for(var g=0;g<b.length;g++){var h=b[g];l(a,h,c,e,f)}},l=function(a,b,e,f,g){"string"!=typeof a&&(a instanceof Object||d(a))&&(c(a[b])||(null!=a[b]&&(void 0===f||f>0)&&j(a[b],e,void 0!==f?f-1:f),p(a,b,e,f),g&&(void 0===f||f>0)&&w(a,b,e,f)))},m=function(){c(arguments[1])?n.apply(this,arguments):d(arguments[1])?o.apply(this,arguments):u.apply(this,arguments)},n=function(a,b){if(!(a instanceof String)&&(a instanceof Object||d(a)))if(d(a)){for(var c=[],e=0;e<a.length;e++)c.push(e);o(a,c,b)}else{var f=function g(a){var c=[];for(var d in a)a.hasOwnProperty(d)&&(a[d]instanceof Object?g(a[d]):c.push(d));o(a,c,b)};f(a)}},o=function(a,b,c){for(var d in b)b.hasOwnProperty(d)&&u(a,b[d],c)},p=function(b,c,d,e){var f=b[c];t(b,c),b.watchers||h(b,"watchers",{});var i=!1;b.watchers[c]||(b.watchers[c]=[],i=!0);for(var k=0;k<b.watchers[c].length;k++)if(b.watchers[c][k]===d)return;if(b.watchers[c].push(d),i){var l=function(){return f},m=function(g){var h=f;f=g,0!==e&&b[c]&&j(b[c],d,void 0===e?e:e-1),t(b,c),a.noMore||h!==g&&(q(b,c,"set",g,h),a.noMore=!1)};g(b,c,l,m)}},q=function y(a,b,c,d,e){if(void 0!==b)for(var f=0;f<a.watchers[b].length;f++)a.watchers[b][f].call(a,b,c,d,e);else for(var b in a)a.hasOwnProperty(b)&&y(a,b,c,d,e);
},r=["pop","push","reverse","shift","sort","slice","unshift","splice"],s=function(a,b,c,d){h(a[b],d,function(){var e=c.apply(a[b],arguments);return l(a,a[b]),"slice"!==d&&q(a,b,d,arguments),e})},t=function(a,b){if(a[b]&&!(a[b]instanceof String)&&d(a[b]))for(var c,e=r.length;e--;)c=r[e],s(a,b,a[b][c],c)},u=function(a,b,c){for(var d=0;d<a.watchers[b].length;d++){var e=a.watchers[b][d];e==c&&a.watchers[b].splice(d,1)}x(a,b,c)},v=function(){for(var a=0;a<b.length;a++){var c=b[a];if("$$watchlengthsubjectroot"===c.prop){var d=e(c.obj,c.actual);(d.added.length||d.removed.length)&&(d.added.length&&k(c.obj,d.added,c.watcher,c.level-1,!0),c.watcher.call(c.obj,"root","differentattr",d,c.actual)),c.actual=f(c.obj)}else{var d=e(c.obj[c.prop],c.actual);if(d.added.length||d.removed.length){if(d.added.length)for(var g=0;g<c.obj.watchers[c.prop].length;g++)k(c.obj[c.prop],d.added,c.obj.watchers[c.prop][g],c.level-1,!0);q(c.obj,c.prop,"differentattr",d,c.actual)}c.actual=f(c.obj[c.prop])}}},w=function(a,c,d,e){var g;g=f("$$watchlengthsubjectroot"===c?a:a[c]),b.push({obj:a,prop:c,actual:g,watcher:d,level:e})},x=function(a,c,d){for(var e=0;e<b.length;e++){var f=b[e];f.obj==a&&f.prop==c&&f.watcher==d&&b.splice(e,1)}};return setInterval(v,50),a.watch=i,a.unwatch=m,a.callWatchers=q,a}),define("widget/parsers/addChildren",[],function(){function a(a,e,f){if(e&&e.name&&a){d(a,e,f),c(a,e,f);var g=b(a,e);return g&&g(f),a.children[e.name]=e,e}}function b(a,b){return void 0!==a.elOnChange[b.name]?function(c){return a.elOnChange[b.name].call(a,b,c)}:!1}function c(a,b,c){void 0!==a.elReady[b.name]&&a.elReady[b.name].call(a,b,c)}function d(a,b,c){var d=a.events[b.name];void 0!==d&&void 0!==b.el&&"cp"!==b.data.type&&d.forEach(function(d){a._events.push(b.on(d.name,d.action,a,c))})}return Object.assign(a,{elOnChange:b,elReady:c,applyEvents:d}),a}),define("widget/parsers/applyAttribute",["watch","./addChildren"],function(a,b){function c(a,c,e){var f=c.data.tplSet.bind,g="true"===c.data.tplSet.update;f&&Object.keys(f).forEach(function(h){var i=f[h],j=e[i];switch(h){case"class":var k=function(a){return void 0!==a&&""!==a?(c.addClass(a),a):!1},l=k(j);g===!0&&d(e,i,function(){l&&c.removeClass(l),l=k(e[i])});break;case"checked":void 0!==j&&(c.el.checked=j),g===!0&&d(e,i,function(){return c.el.checked=e[i]});break;case"value":void 0!==j&&(c.el.value=j),g===!0&&d(e,i,function(){return c.el.value=e[i]});break;case"required":void 0!==j&&(c.el.required=j),g===!0&&d(e,i,function(){return c.el.required=e[i]});break;case"text":void 0!==j&&c.text(j),g===!0&&d(e,i,function(){return c.text(e[i])});break;default:void 0!==j&&c.setAttribute(h,j),g===!0&&d(e,i,function(){return c.setAttribute(h,e[i])})}void 0!==e.text&&"text"!==h&&(c.text(e.text),g===!0&&"text"!==h&&d(e,"text",function(){return c.text(e.text)})),g===!0&&!function(){var f=b.elOnChange(a,c);f&&d(e,i,function(){return f(e)})}()})}var d=a.watch;return c}),define("widget/parsers/applyParent",["templating/dom","./addChildren"],function(a,b){function c(c){var d=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],e=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];c&&!function(){var f=c.children;f&&Object.keys(f).forEach(function(g){var h=!0,i=f[g],j=d[g];void 0!==j?void 0!==c.nodes[g]?c.nodes[g].call(c,i,j,e):void 0!==i&&("string"==typeof j?a.text(i,j):i=j.run(i.el)):void 0!==c.nodes[g]&&"true"===i.data.tplSet.noattach&&(c.nodes[g].call(c,i,e),h=!1),h&&i.elGroup.size>0&&b(c,i,e)})}()}return c}),define("widget/utils",[],function(){function a(a){var b="undefined"==typeof a?"undefined":_typeof(a);if(!("function"===b||"object"===b&&a))return a;for(var c,d,e=1,f=arguments.length;f>e;e++){c=arguments[e];for(d in c)a[d]=c[d]}return a}function b(b,c){var d,e=this;d=b&&null!=b&&hasOwnProperty.call(b,"constructor")?b.constructor:function(){return e.apply(this,arguments)},a(d,e,c);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,b&&a(d.prototype,b),d.__super__=e.prototype,d}function c(a){return"[object String]"===toString.call(a)}function d(a){return a===Object(a)}function e(a){return Array.isArray?Array.isArray(a):"[object Array]"===toString.call(a)}return{fnExtend:b,extend:a,isString:c,isObject:d,isArray:e}}),define("widget/parsers/setBinders",[],function(){function a(a,b){var c={};return Object.defineProperty(c,"__cp__",{enumerable:!1,value:[]}),Object.keys(a).forEach(function(d){var e=a[d];e&&e.data&&void 0!==e.data.bind&&"cp"!==e.data.type?(c[e.data.bind]=c[e.data.bind]||[],c[e.data.bind].push(e)):b||"cp"!==e.data.type||c.__cp__.push(e)}),c}return a}),define("widget/parsers/applyBinders",["templating/dom","../utils","watch","./setBinders","./addChildren","./applyAttribute"],function(a,b,c,d,e,f){function g(a,c,g,j){if(void 0!==j){var k=g[c];if(a.nodes[c])a.nodes[c].call(a,j,k);else if(b.isArray(k)||b.isObject(k)){if(b.isArray(k))!function(){var l=[],m=function(k,m){var n=!1;b.isArray(k)||b.isObject(k)||(n=!0);var o=j.run(!0,m);n&&(o.text(k),"true"===o.data.tplSet.update&&i(g,c,function(){o.text(k);var b=e.elOnChange(a,o);b&&b(k)})),l.push({binder:o,data:k}),f(a,o,k),e.applyEvents(a,o,k),e.elReady(a,o,k);var p=e.elOnChange(a,o);p&&p(k),o.children&&(o.bindings=d(o.children),h(a,k,o))};k.forEach(m);var n=j.data.tplSet.update;"true"===n&&!function(){var a=["pop","shift","splice"],b=["push","unshift"],d=["reverse","sort"];i(g,c,function(e,f,h,i){var j=l.slice(0);if(void 0===i&&-1!==b.indexOf(f)){var n=j.filter(function(a){return a.data===h[0]});0===n.length&&m(h[0],"unshift"===f?0:j.length)}else if(-1!==a.indexOf(f)){if(j.forEach(function(a){-1===g[c].indexOf(a.data)&&(a.binder.remove(),l.splice(l.indexOf(a),1))}),"splice"===f){var o=Array.prototype.slice.call(h,2);o&&o.length>0&&o.forEach(function(a){var b=g[c].indexOf(a);-1!==b&&m(a,b)})}}else-1!==d.indexOf(f)&&k.forEach(function(a,b){var c=j.filter(function(b){return b.data===a})[0];l.splice(b,0,l.splice(l.indexOf(c),1)[0]),c.binder.changePosition(b)})})}()}();else if(b.isObject(k)){var l=j.run(k);if("cp"!==l.data.type){f(a,l,k),e.applyEvents(a,l,k),e.elReady(a,l,k);var m=e.elOnChange(a,l);m&&m(k),l.children&&(l.bindings=d(l.children),h(a,k,l))}}}else!function(){var b=j.run(!0);b.text(k),e.applyEvents(a,b,k),e.elReady(a,b,k);var d=e.elOnChange(a,b);d&&d(k),"true"===b.data.tplSet.update&&i(g,c,function(){b.text(g[c]);var d=e.elOnChange(a,b);d&&d(g[c])})}()}}function h(a,b,c){var d=c.bindings;if(d){d.__cp__.length>0&&d.__cp__.forEach(function(c){var d=c.run(b);d.setContext(a.context),e.elReady(a,d,b);var f=e.elOnChange(a,d);f&&f(b)});var f=Object.keys(d);b&&f.length>0&&f.forEach(function(c){void 0!==b[c]?d[c].forEach(function(d){return g(a,c,b,d)}):!function(){var e=function f(e,h,i,k){void 0!==i&&void 0===k&&(d[c].forEach(function(d){return g(a,c,b,d)}),j(b,c,f))};i(b,c,e,0)}()})}}var i=c.watch,j=c.unwatch;return h}),define("widget/parsers/setRoutes",["templating/dom"],function(a){function b(a){var b=a.toString().replace(h,""),c=b.slice(b.indexOf("(")+1,b.indexOf(")")),d=c.match(i);return null===d?[]:d.map(function(a){return a.replace(/[\s,]/g,"")})}function c(a){void 0!==a.remove&&a.remove()}function d(a,b){void 0!==a&&Object.keys(a).forEach(function(c){var d=a[c];e(d,b)||b(d)})}function e(a,b){return a.elGroup&&a.elGroup.size>0?(a.elGroup.forEach(function(a){b(a)}),!0):!1}function f(g,h){g.setContext?g.setContext(h):!function(){var i=void 0!==g.data?g.data.route:void 0;void 0!==i&&"rt"===g.data.type?!function(){var j=void 0,k=h.match,l=h.active,m=k(i);m.to(function(){for(var b=arguments.length,c=Array(b),h=0;b>h;h++)c[h]=arguments[h];var m=c.pop();if(j=c.length>0?m.getLocation()+"_"+c.join("_"):void 0,!e(g,function(b){return a.attach(b)})){var n=g.run(!0);d(n.children,function(a){a&&k(i,function(b){return f(a,{match:b,active:l})})})}e(g,function(a){d(a.children,function(a){a&&a.to&&a.to.apply(a,_toConsumableArray(c.concat(m)))})})}),m.leave(function(f){var h=0,i=!1;e(g,function(e){var g=function(){j?c(e):a.detach(e)},k=function m(){var m=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];m?h--:(i=!0,f(!1)),0!==h||i||(l.set(e,g),f(!0))};d(e.children,function(a){if(a&&void 0!==a.leave){var c=b(a.leave);c.length>0&&h++,a.leave(k)}}),0===h&&(l.set(e,g),f(!0))})}),m.query(function(a){e(g,function(b){d(b.children,function(b){b&&void 0!==b.query&&b.query(a)})})}),e(g,function(a){return a._activeRoute=m})}():void 0!==g.children&&-1===["cp"].indexOf(g.data.type)&&d(g.children,function(a){return f(a,h)})}()}function g(a,b){d(a,function(a){return f(a,b)})}var h=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,i=/(?:^|,)\s*([^\s,=]+)/g;return g}),define("widget/parsers/applyElement",["templating/dom"],function(a){function b(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=arguments[1],d={};return Object.keys(b).forEach(function(e){var f=b[e];"string"!=typeof f&&!function(){var b=f.elGroup.first;b?(d[e]=b,b instanceof a.Element==!0&&-1!==["pl"].indexOf(b.data.type)&&!function(){var a=b.data.tplSet.bind;a&&Object.keys(a).forEach(function(d){void 0!==c[a[d]]&&("class"!==d?b.setAttribute(d,c[a[d]]):b.addClass(c[a[d]]))})}()):d[e]=f}()}),d}return b}),define("widget/Constructor",["require","templating/Decoder","templating/dom","./Mediator","./parsers/applyAttribute","./parsers/applyParent","./parsers/applyBinders","./parsers/setBinders","./parsers/setRoutes","./parsers/applyElement","./parsers/addChildren"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a){var b=Object.keys(a);b.length>0&&b.forEach(function(b){if("root"!==b){var c=a[b];void 0!==c.elGroup&&c.elGroup.size>0&&c.elGroup.forEach(function(a){void 0!==a&&void 0!==a.remove&&a.remove(!0)})}})}var m=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=arguments[1],e=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],f=arguments[3];_classCallCheck(this,a),this.instance=this,this._appliedRoutes=[],this._events=[],this._globalEvents=[],this._parentChildren=c,this._options=b,this._rendered=!1,this._arguments=arguments,this._dataSet=e,this.eventBus=new d(this),void 0!==f&&void 0!==f.name&&(this.name=f.name),this.beforeInit.apply(this,_toConsumableArray(this._arguments))}return _createClass(a,null,[{key:"extend",value:function(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),b}(a);return Object.assign(c.prototype,b),c}}]),_createClass(a,[{key:"ready",value:function(a){this.el=a}},{key:"setContext",value:function(a){this.context=a,this.async||this.render(),this.init.apply(this,_toConsumableArray(this._arguments))}},{key:"render",value:function(a){if(!this._rendered&&this.template){a&&(this.data=a);var d=this._options,e=this._parentChildren,g=new b(this.template),l=g.render(this.data);if(this.el){var m=this.el.parentNode;m&&m.replaceChild(l.fragment,this.el),this.elGroup&&this.elGroup.get(this.el)&&(this.elGroup["delete"](this.el),this.el=l.fragment,this.elGroup.set(l.fragment,this))}else this.el=l.fragment;this.root=new c.Element(l.fragment,{name:"root",data:{}}),this.children=j(l.children,d),f(this,e,this.data),this.bindings=h(this.children,!0),this.data&&this.applyBinders(this.data,this),i(this.children,this.context),k(this,this.root),this.rendered.apply(this,_toConsumableArray(this._arguments)),this._rendered=!0}}},{key:"beforeInit",value:function(a,b,c){}},{key:"init",value:function(a,b,c){}},{key:"rendered",value:function(a,b,c){}},{key:"loadCss",value:function(a){if(this.context._cssReady=this.context._cssReady||[],-1===this.context._cssReady.indexOf(a)){this.context._cssReady.push(a);var b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("href",a),"undefined"!=typeof b&&document.getElementsByTagName("head")[0].appendChild(b)}}},{key:"detach",value:function(){this._placeholder||(this._placeholder=document.createElement(this.el.tagName)),this._parent||(this._parent=this.el.parentNode),this.el&&this._parent&&this._parent.replaceChild(this._placeholder,this.el)}},{key:"attach",value:function(){this._placeholder&&this._parent&&this._parent.replaceChild(this.el,this._placeholder)}},{key:"onDestroy",value:function(){}},{key:"destroy",value:function(){for(this.onDestroy(),this.eventBus.clear();this._events.length>0;)this._events.shift().remove();for(;this._globalEvents.length>0;)this._globalEvents.shift().remove();l(this.children),void 0!==this.elGroup&&void 0!==this.el&&this.elGroup["delete"](this.el),this.root&&this.root.remove&&this.root.remove(),delete this.el}},{key:"remove",value:function(){this.destroy.apply(this,arguments)}},{key:"setChildren",value:function(a,b){var c=a.data.name,d=this.children[c];void 0!==d&&void 0!==d.el&&d.remove(),d=a.run(b||!0),k(this,d,b)}},{key:"addComponent",value:function(a,b){var c=b.name,d=b.container;if(void 0===c)throw"you have to define data.name for component.";if(void 0===d)throw"You have to define container for component.";if(void 0!==this.children[c])throw"Component using name:"+c+"! already defined.";var e=this.setComponent(a,b),f=e.run(b.container);return f.setContext(this.context),this.children[c]=f,f}},{key:"setComponent",value:function(a,b){var d=this,e={name:b.name,data:{tag:"div",type:"cp"},run:function(e){b.appContext=d.context;var f=new a(b,b.children,b.data),g=document.createElement("div");return g.setAttribute("style","display:none;"),f.ready(g),e instanceof HTMLElement==!0?e.parentNode.replaceChild(f.el,e):void 0!==e.el&&void 0!==b.pos?c.insertBefore(e,f,b.pos):void 0!==e.el&&c.append(e,f),f}};return e}},{key:"applyBinders",value:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return g.apply(void 0,[this].concat(b))}},{key:"context",set:function(a){var b=this;if(!this.data){var c=this._dataSet?Object.keys(this._dataSet):[],d=c.length>0?this._dataSet:a.data;d&&(this.data=d[this._options.bind]||d)}a.match(function(c){b.match&&b.match(c),b._context=Object.assign({match:c},a)})},get:function(){return this._context}}]),a}();return Object.assign(m.prototype,{nodes:{},events:{},elReady:{},elOnChange:{}}),m});